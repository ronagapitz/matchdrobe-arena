<!DOCTYPE HTML>
<html>
  <head>
    <meta charset="UTF-8"/>

        <script type="text/javascript" src="phonegap.js"></script>
		        <script type="text/javascript" src="childbrowser.js"></script>

		
		        <script type="text/javascript" src="js/jquery.js"></script>
				
						        <script type="text/javascript" src="js/mobile.js"></script>

    <script>
	
	 // Load the SDK asynchronously
  (function(d){
     var js, id = 'facebook-jssdk', ref = d.getElementsByTagName('script')[0];
     if (d.getElementById(id)) {return;}
     js = d.createElement('script'); js.id = id; js.async = true;
     js.src = "//connect.facebook.net/en_US/all.js";
     ref.parentNode.insertBefore(js, ref);
   }(document));
    function deviceStart() {

   FB.init({ appId: "493708454047333", nativeInterface: PG.FB });

};
$(function()
{
deviceStart()
});


function onPubFacebookBtn(){ // I call this from a button
var my_client_id  = "493708454047333",
my_redirect_uri   = "http://www.facebook.com/connect/login_success.html",
my_type           = "user_agent",
my_display        = "touch"

var authorize_url  = "https://graph.facebook.com/oauth/authorize?";
authorize_url += "client_id="+my_client_id;
authorize_url += "&redirect_uri="+my_redirect_uri;
authorize_url += "&display="+my_display;
authorize_url += "&scope=publish_stream,user_photos,email,user_online_presence,offline_access"

window.plugins.childBrowser.onLocationChange = facebookLocChanged;
window.plugins.childBrowser.onClose = closed;
window.plugins.childBrowser.showWebPage(authorize_url);

}

function facebookLocChanged(loc){

if (/login_success/.test(loc)) { 
   var fbCode = loc.match(/code=(.*)$/)[1]

   localStorage.setItem('pg_fb_session', JSON.stringify(fbCode));

   FB.Auth.setSession(fbCode, 'connected');
   window.plugins.childBrowser.close();
}}
	
function getLoginStatus() {
FB.getLoginStatus(function(response) {
 if (response.session) {
     alert('logged in');
 } else {
   alert('not logged in');
}
});
}
	
function me() {
FB.api('/me', function(response) {
    if (response.error) {
        alert(JSON.stringify(response.error));
     } else {
         var data = document.getElementById('data');
          response.data.forEach(function(item) {
           var d = document.createElement('div');
           d.innerHTML = item.name;
           data.appendChild(d);
       });
       }
});
}
    </script>
  </head>

  <body>
    <!--Connect Screen-->
    <div data-role="page" id="connect-page">
      <div data-role="header" data-position="fixed">
        <h1>Monaca<br/>with Facebook</h1>
      </div>
      <div data-role="content" align="middle">
        <img src="images/facebook_icon.jpg" alt="Connect to Facebook" width="300">
        <input id="connect-button" type="button" value="Connect" onclick="onPubFacebookBtn();" data-theme="b">
      </div>
    </div>

    <!--List of Friends Screen-->
    <div data-role="page" id="list-page">
      <div data-role="header">
        <h1>Monaca
        <br/>with Facebook</h1>
        <a href="#yesNoDialog" class="ui-btn-right" data-rel="popup" data-position-to="window" data-role="button" data-inline="true" data-transition="pop" data-theme="b">Logout</a>
      </div>

      <div data-role="content">
        <table border="0">
          <tr>
            <td colspan="2">
                <h3>Currently login as:</h3>
            </td>
          </tr>
          <tr align="center">
            <td>
            <img id="profilePic" src="" alt="Facebook Profile Picture">
            </td>
            <td>
              <h3 id="info"></h3>
            </td>
          </tr>
        </table>
        <hr/>
        <h3>List of Friends:</h3>
        <ul id="fbFriends">
          <!-- Display list of friends here -->
        </ul>

        <!--Dialog box confirming logout-->
        <div data-role="popup" id="yesNoDialog" data-overlay-theme="a" data-theme="c" data-dismissible="false" style="max-width:400px;" class="ui-corner-all">
          <div data-role="header" data-theme="a" class="ui-corner-top">
            <h1>Confirmation:</h1>
          </div>
          <div align="middle" data-role="content" data-theme="d" class="ui-corner-bottom ui-content">
            <h3 class="ui-title">
            <p>Are you sure you want to logout?</p>
            <a href="javascript:Logout();" data-role="button" data-inline="true" data-transition="flow" data-theme="b">Yes</a>
            <a href="#" data-role="button" data-inline="true" data-rel="back" data-transition="flow" data-theme="b">No</a>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>